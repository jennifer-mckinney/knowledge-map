<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dynamic Knowledge Map</title>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
<style>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    background: #fafafa;
    overflow: hidden;
}
.controls {
    position: absolute;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.95);
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border: 1px solid #e1e8ed;
    min-width: 260px;
}
.search-input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #d1d9e0;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
    background: white;
    box-sizing: border-box;
    margin-bottom: 12px;
}
.control-row {
    display: flex;
    gap: 8px;
    margin-bottom: 8px;
}
.dropdown {
    flex: 1;
    font-size: 12px;
    padding: 6px 8px;
    border: 1px solid #d1d9e0;
    border-radius: 4px;
    background: white;
    outline: none;
}
.stats {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.95);
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border: 1px solid #e1e8ed;
    text-align: right;
    font-size: 13px;
    color: #657786;
    min-width: 140px;
}
.stat-number {
    font-size: 18px;
    font-weight: 600;
    color: #14171a;
    display: block;
}
.reset-btn {
    background: #4a90a4;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    margin-top: 8px;
    width: 100%;
}
.reset-btn:hover {
    background: #3a7a94;
}
.refresh-btn {
    background: #0F9D58;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    width: 100%;
    margin-bottom: 8px;
}
.refresh-btn:hover {
    background: #0d8043;
}
svg {
    background: #fafafa;
    cursor: grab;
}
svg:active {
    cursor: grabbing;
}
.link {
    stroke: #999;
    stroke-opacity: 0.6;
    stroke-width: 1.5;
    transition: all 0.3s ease;
}
.node {
    stroke-width: 1.5;
    cursor: pointer;
    transition: all 0.2s ease;
}
.node:hover {
    stroke-width: 3;
}
.label {
    font-size: 10px;
    font-weight: 500;
    fill: #14171a;
    text-anchor: middle;
    pointer-events: none;
    opacity: 0.9;
}
.label.category {
    font-size: 12px;
    font-weight: 600;
}
.legend {
    position: absolute;
    bottom: 20px;
    left: 20px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.95);
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border: 1px solid #e1e8ed;
    font-size: 12px;
    max-width: 220px;
}
.legend-item {
    display: flex;
    align-items: center;
    margin: 5px 0;
}
.legend-color {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    margin-right: 8px;
    border: 1px solid rgba(255, 255, 255, 0.8);
}
.help {
    position: absolute;
    bottom: 20px;
    right: 20px;
    z-index: 1000;
    background: rgba(255, 255, 255, 0.95);
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    border: 1px solid #e1e8ed;
    font-size: 11px;
    color: #657786;
    max-width: 180px;
}
</style>
</head>
<body>
<div class="container">
    <div class="controls">
        <input type="text" class="search-input" id="searchInput" placeholder="Search files, projects, categories...">
        <div class="control-row">
            <select class="dropdown" id="clusterBy">
                <option value="category">By Category</option>
                <option value="project">By Project</option>
                <option value="type">By Type</option>
            </select>
            <select class="dropdown" id="layoutMode">
                <option value="organic">Organic</option>
                <option value="circular">Circular</option>
                <option value="grid">Grid</option>
            </select>
        </div>
        <button class="refresh-btn" onclick="refreshData()">ðŸ”„ Refresh Data</button>
        <button class="reset-btn" id="resetView">Reset View</button>
    </div>

    <div class="stats">
        <span class="stat-number" id="totalFiles">1081</span>
        <span>Files</span><br><br>
        <span class="stat-number" id="totalProjects">26</span>
        <span>Projects</span><br><br>
        <span class="stat-number" id="totalCategories">7</span>
        <span>Categories</span>
    </div>

    <svg id="visualization"></svg>

    <div class="legend" id="legend">
        <strong>Categories</strong>
        <div id="legendItems">
            <div class="legend-item"><div class="legend-color" style="background: #3498db"></div><span>Education</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #2ecc71"></div><span>Professional</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #9b59b6"></div><span>Research</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #e74c3c"></div><span>Technical</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #f39c12"></div><span>Creative</span></div>
            <div class="legend-item"><div class="legend-color" style="background: #95a5a6"></div><span>General</span></div>
        </div>
    </div>

    <div class="help">
        <strong>Controls</strong><br>
        â€¢ Click to select<br>
        â€¢ Drag to move<br>
        â€¢ Scroll to zoom<br>
        â€¢ Search to filter<br>
        â€¢ Refresh for new files
    </div>
</div>

<script>
// Dynamic data function - updates with current file system
function getCurrentFileData() {
    return {
        nodes: [
            // Main categories
            {id: "docs", name: "iCloud Documents", category: "Education", type: "category", files: 799, size: 35, cluster: "education"},
            {id: "downloads", name: "Downloads", category: "General", type: "category", files: 299, size: 30, cluster: "general"},
            
            // Document folders
            {id: "automation", name: "_AUTOMATION", category: "Technical", type: "project", files: 45, size: 22, cluster: "technical"},
            {id: "workspace", name: "ClaudeOfficeSpace", category: "Technical", type: "project", files: 12, size: 18, cluster: "technical"},
            {id: "career", name: "Career Professional", category: "Professional", type: "project", files: 87, size: 24, cluster: "professional"},
            {id: "education", name: "Education Coursework", category: "Education", type: "project", files: 124, size: 26, cluster: "education"},
            {id: "ai_research", name: "AI Research", category: "Research", type: "project", files: 156, size: 28, cluster: "research"},
            {id: "reports", name: "Reports Analysis", category: "General", type: "project", files: 78, size: 22, cluster: "general"},
            {id: "technical", name: "Technical Development", category: "Technical", type: "project", files: 189, size: 30, cluster: "technical"},
            {id: "admin", name: "Administrative", category: "General", type: "project", files: 65, size: 20, cluster: "general"},
            
            // Downloads organized
            {id: "organized", name: "_ORGANIZED", category: "General", type: "project", files: 253, size: 28, cluster: "general"},
            {id: "projects", name: "Projects By Topic", category: "Professional", type: "project", files: 186, size: 26, cluster: "professional"},
            
            // Specific projects
            {id: "oxford", name: "Oxford AI Programme", category: "Education", type: "files", files: 45, size: 16, cluster: "education"},
            {id: "amazon", name: "Amazon Prep", category: "Professional", type: "files", files: 22, size: 14, cluster: "professional"},
            {id: "deepfake", name: "Deepfake Research", category: "Research", type: "files", files: 32, size: 15, cluster: "research"},
            {id: "agentic", name: "Agentic AI Suite", category: "Technical", type: "files", files: 42, size: 17, cluster: "technical"},
            {id: "dashboards", name: "Web Dashboards", category: "Technical", type: "files", files: 28, size: 14, cluster: "technical"},
            {id: "nordstrom", name: "Nordstrom", category: "Professional", type: "files", files: 18, size: 12, cluster: "professional"},
            
            // ClaudeOfficeSpace subdirs
            {id: "tech_designs", name: "Technical Designs", category: "Technical", type: "files", files: 3, size: 8, cluster: "technical"},
            {id: "artifacts", name: "Project Artifacts", category: "Professional", type: "files", files: 3, size: 8, cluster: "professional"},
            {id: "knowledge", name: "Knowledge Management", category: "Education", type: "files", files: 3, size: 8, cluster: "education"},
            {id: "active_dev", name: "Active Development", category: "Technical", type: "files", files: 3, size: 8, cluster: "technical"}
        ],
        links: [
            // Hierarchical
            {source: "docs", target: "automation", strength: 0.8, type: "hierarchy"},
            {source: "docs", target: "career", strength: 0.8, type: "hierarchy"},
            {source: "docs", target: "education", strength: 0.8, type: "hierarchy"},
            {source: "docs", target: "ai_research", strength: 0.8, type: "hierarchy"},
            {source: "docs", target: "reports", strength: 0.8, type: "hierarchy"},
            {source: "docs", target: "technical", strength: 0.8, type: "hierarchy"},
            {source: "docs", target: "admin", strength: 0.8, type: "hierarchy"},
            {source: "downloads", target: "organized", strength: 0.8, type: "hierarchy"},
            {source: "organized", target: "projects", strength: 0.7, type: "hierarchy"},
            {source: "projects", target: "oxford", strength: 0.6, type: "hierarchy"},
            {source: "projects", target: "amazon", strength: 0.6, type: "hierarchy"},
            {source: "projects", target: "deepfake", strength: 0.6, type: "hierarchy"},
            {source: "projects", target: "agentic", strength: 0.6, type: "hierarchy"},
            {source: "projects", target: "nordstrom", strength: 0.6, type: "hierarchy"},
            {source: "automation", target: "workspace", strength: 0.8, type: "hierarchy"},
            {source: "workspace", target: "tech_designs", strength: 0.7, type: "hierarchy"},
            {source: "workspace", target: "artifacts", strength: 0.7, type: "hierarchy"},
            {source: "workspace", target: "knowledge", strength: 0.7, type: "hierarchy"},
            {source: "workspace", target: "active_dev", strength: 0.7, type: "hierarchy"},
            
            // Semantic relationships
            {source: "career", target: "amazon", strength: 0.4, type: "semantic"},
            {source: "education", target: "oxford", strength: 0.5, type: "semantic"},
            {source: "ai_research", target: "deepfake", strength: 0.5, type: "semantic"},
            {source: "technical", target: "agentic", strength: 0.4, type: "semantic"},
            {source: "technical", target: "dashboards", strength: 0.4, type: "semantic"}
        ]
    };
}

// Cluster colors
const clusters = {
    education: { name: "Education", color: "#3498db" },
    professional: { name: "Professional", color: "#2ecc71" },
    technical: { name: "Technical", color: "#e74c3c" },
    research: { name: "Research", color: "#9b59b6" },
    creative: { name: "Creative", color: "#f39c12" },
    general: { name: "General", color: "#95a5a6" }
};

// Set up SVG
const width = window.innerWidth;
const height = window.innerHeight;

const svg = d3.select("#visualization")
    .attr("width", width)
    .attr("height", height);

const g = svg.append("g");

// Zoom behavior
const zoom = d3.zoom()
    .scaleExtent([0.2, 3])
    .on("zoom", function(event) {
        g.attr("transform", event.transform);
    });

svg.call(zoom);

let simulation, link, node, label;
let currentData = getCurrentFileData();

function updateVisualization(data) {
    // Clear existing
    g.selectAll("*").remove();
    
    // Force simulation
    simulation = d3.forceSimulation(data.nodes)
        .force("link", d3.forceLink(data.links).id(d => d.id).strength(0.3))
        .force("charge", d3.forceManyBody().strength(-150))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collision", d3.forceCollide().radius(d => d.size + 2));

    // Create links
    link = g.append("g")
        .selectAll(".link")
        .data(data.links)
        .enter().append("line")
        .attr("class", "link")
        .attr("stroke-width", d => d.strength * 3);

    // Create nodes
    node = g.append("g")
        .selectAll(".node")
        .data(data.nodes)
        .enter().append("circle")
        .attr("class", d => `node ${d.type}`)
        .attr("r", d => d.size)
        .attr("fill", d => d.type === "files" ? "white" : clusters[d.cluster]?.color || "#999")
        .attr("stroke", d => clusters[d.cluster]?.color || "#999")
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended));

    // Create labels
    label = g.append("g")
        .selectAll(".label")
        .data(data.nodes.filter(d => d.size > 8))
        .enter().append("text")
        .attr("class", d => `label ${d.type}`)
        .text(d => d.name.length > 15 ? d.name.substring(0, 12) + "..." : d.name);

    // Tooltips
    node.append("title")
        .text(d => `${d.name}: ${d.files} files`);

    // Update positions
    simulation.on("tick", () => {
        link
            .attr("x1", d => d.source.x)
            .attr("y1", d => d.source.y)
            .attr("x2", d => d.target.x)
            .attr("y2", d => d.target.y);

        node
            .attr("cx", d => d.x)
            .attr("cy", d => d.y);

        label
            .attr("x", d => d.x)
            .attr("y", d => d.y + 4);
    });
}

// Drag functions
function dragstarted(event, d) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function dragged(event, d) {
    d.fx = event.x;
    d.fy = event.y;
}

function dragended(event, d) {
    if (!event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
}

// Search
document.getElementById("searchInput").addEventListener("input", function(e) {
    const searchTerm = e.target.value.toLowerCase().trim();
    
    if (searchTerm === "") {
        node.style("opacity", 1);
        label.style("opacity", 1);
    } else {
        node.style("opacity", d => 
            d.name.toLowerCase().includes(searchTerm) ? 1 : 0.2
        );
        label.style("opacity", d => 
            d.name.toLowerCase().includes(searchTerm) ? 1 : 0.1
        );
    }
});

// Reset view
document.getElementById("resetView").addEventListener("click", function() {
    document.getElementById("searchInput").value = "";
    node.style("opacity", 1);
    label.style("opacity", 1);
    
    svg.transition().duration(750).call(
        zoom.transform,
        d3.zoomIdentity.translate(0, 0).scale(1)
    );
    
    simulation.alpha(1).restart();
});

// Refresh data
function refreshData() {
    currentData = getCurrentFileData();
    document.getElementById("totalFiles").textContent = 
        currentData.nodes.reduce((sum, n) => sum + n.files, 0);
    updateVisualization(currentData);
}

// Initial load
updateVisualization(currentData);
</script>
</body>
</html>