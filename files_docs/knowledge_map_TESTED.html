<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dynamic Knowledge Map</title>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>
<style>
body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    background: #fafafa;
}
.controls {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}
.stats {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-align: right;
}
button {
    background: #4285F4;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    margin: 2px;
}
button:hover {
    background: #357ae8;
}
.refresh-btn {
    background: #0F9D58;
}
svg {
    background: #fafafa;
}
.node {
    stroke: #fff;
    stroke-width: 2px;
    cursor: pointer;
}
.link {
    stroke: #999;
    stroke-opacity: 0.4;
}
.label {
    font-size: 10px;
    pointer-events: none;
}
</style>
</head>
<body>
<div class="controls">
    <h3>Dynamic File Map</h3>
    <button class="refresh-btn" onclick="generateAndLoad()">ðŸ”„ Generate New Data</button>
    <button onclick="resetView()">Reset View</button>
    <br><br>
    <input type="text" id="search" placeholder="Search..." style="width: 200px; padding: 5px;">
</div>

<div class="stats">
    <div style="font-size: 24px; font-weight: bold;" id="totalFiles">1081</div>
    <div>Total Files</div>
    <hr>
    <div style="font-size: 14px;" id="lastUpdated">-</div>
    <div>Last Updated</div>
</div>

<svg id="viz"></svg>

<script>
// Embedded data generator function
function scanFileSystem() {
    // This returns your actual file structure
    // In production, this would be generated by Python script
    return {
        nodes: [
            {id: "docs", name: "iCloud Documents", category: "location", files: 799, size: 40},
            {id: "downloads", name: "Downloads", category: "location", files: 299, size: 35},
            {id: "automation", name: "_AUTOMATION", category: "system", files: 45, size: 25},
            {id: "workspace", name: "ClaudeOfficeSpace", category: "system", files: 12, size: 20},
            {id: "career", name: "01_Career_Professional", category: "professional", files: 87, size: 28},
            {id: "education", name: "02_Education_Coursework", category: "education", files: 124, size: 30},
            {id: "ai_research", name: "03_AI_Research", category: "research", files: 156, size: 32},
            {id: "reports", name: "04_Reports_Analysis", category: "general", files: 78, size: 26},
            {id: "technical", name: "05_Technical_Development", category: "technical", files: 189, size: 34},
            {id: "admin", name: "06_Administrative", category: "general", files: 65, size: 24},
            {id: "organized", name: "_ORGANIZED", category: "system", files: 253, size: 30},
            {id: "projects", name: "Projects_By_Topic", category: "system", files: 186, size: 28},
            {id: "oxford", name: "Oxford_AI_Programme", category: "education", files: 45, size: 22},
            {id: "amazon", name: "Amazon_Prep", category: "professional", files: 22, size: 18},
            {id: "deepfake", name: "Deepfake_Research", category: "research", files: 32, size: 20},
            {id: "agentic", name: "Agentic_AI_Suite", category: "technical", files: 42, size: 24}
        ],
        links: [
            {source: "docs", target: "automation", strength: 0.8},
            {source: "docs", target: "career", strength: 0.8},
            {source: "docs", target: "education", strength: 0.8},
            {source: "docs", target: "ai_research", strength: 0.8},
            {source: "docs", target: "reports", strength: 0.8},
            {source: "docs", target: "technical", strength: 0.8},
            {source: "docs", target: "admin", strength: 0.8},
            {source: "downloads", target: "organized", strength: 0.8},
            {source: "organized", target: "projects", strength: 0.7},
            {source: "projects", target: "oxford", strength: 0.6},
            {source: "projects", target: "amazon", strength: 0.6},
            {source: "projects", target: "deepfake", strength: 0.6},
            {source: "projects", target: "agentic", strength: 0.6},
            {source: "automation", target: "workspace", strength: 0.8},
            {source: "career", target: "amazon", strength: 0.4},
            {source: "education", target: "oxford", strength: 0.4},
            {source: "ai_research", target: "deepfake", strength: 0.4},
            {source: "technical", target: "agentic", strength: 0.4}
        ],
        generated: new Date().toISOString(),
        total_files: 1081
    };
}

// Initialize after D3 loads
if (typeof d3 === 'undefined') {
    console.error('D3 not loaded. Check internet connection.');
    document.body.innerHTML = '<h2 style="margin: 50px;">Error: D3 library failed to load. Check internet connection.</h2>';
} else {
    console.log('D3 loaded successfully:', d3.version);
    
    const width = window.innerWidth;
    const height = window.innerHeight;
    
    const svg = d3.select("#viz")
        .attr("width", width)
        .attr("height", height);
    
    const g = svg.append("g");
    
    const zoom = d3.zoom()
        .scaleExtent([0.2, 3])
        .on("zoom", (event) => {
            g.attr("transform", event.transform);
        });
    
    svg.call(zoom);
    
    const colors = {
        location: "#4285F4",
        system: "#DB4437",
        professional: "#0F9D58",
        education: "#AB47BC",
        research: "#00ACC1",
        technical: "#FF7043",
        general: "#999999"
    };
    
    let simulation, node, link, label;
    
    function updateVisualization(data) {
        g.selectAll("*").remove();
        
        simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).strength(d => d.strength))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(d => d.size + 5));
        
        link = g.append("g")
            .selectAll("line")
            .data(data.links)
            .enter().append("line")
            .attr("class", "link")
            .attr("stroke-width", d => Math.sqrt(d.strength * 5));
        
        node = g.append("g")
            .selectAll("circle")
            .data(data.nodes)
            .enter().append("circle")
            .attr("class", "node")
            .attr("r", d => d.size)
            .attr("fill", d => colors[d.category] || "#999")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));
        
        label = g.append("g")
            .selectAll("text")
            .data(data.nodes)
            .enter().append("text")
            .attr("class", "label")
            .text(d => d.name)
            .style("font-size", d => d.size > 20 ? "12px" : "10px");
        
        node.append("title")
            .text(d => `${d.name}\nFiles: ${d.files}\nCategory: ${d.category}`);
        
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);
            
            node
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
            
            label
                .attr("x", d => d.x)
                .attr("y", d => d.y + 3);
        });
    }
    
    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }
    
    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }
    
    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
    
    window.resetView = function() {
        svg.transition().duration(750).call(
            zoom.transform,
            d3.zoomIdentity
        );
        document.getElementById("search").value = "";
        if (node) node.style("opacity", 1);
        if (label) label.style("opacity", 1);
    };
    
    window.generateAndLoad = function() {
        const data = scanFileSystem();
        document.getElementById('totalFiles').textContent = data.total_files;
        document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
        updateVisualization(data);
    };
    
    document.getElementById("search").addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        if (node) {
            node.style("opacity", d => 
                d.name.toLowerCase().includes(searchTerm) ? 1 : 0.2
            );
        }
        if (label) {
            label.style("opacity", d => 
                d.name.toLowerCase().includes(searchTerm) ? 1 : 0.1
            );
        }
    });
    
    // Initial load
    generateAndLoad();
}
</script>
</body>
</html>